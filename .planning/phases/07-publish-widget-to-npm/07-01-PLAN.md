---
phase: 07-publish-widget-to-npm
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/widget/package.json
  - packages/widget/README.md
  - packages/widget/LICENSE
autonomous: true

must_haves:
  truths:
    - "npm pack --dry-run shows README.md, LICENSE, dist/*, and package.json"
    - "package.json has repository, homepage, bugs, author, publishConfig fields"
    - "README.md contains installation command, usage example with all required props, and API reference table"
    - "Build succeeds and dist/ contains ES module, UMD, and TypeScript definitions"
  artifacts:
    - path: "packages/widget/README.md"
      provides: "Package documentation for npmjs.com"
      min_lines: 60
    - path: "packages/widget/LICENSE"
      provides: "MIT license file"
      contains: "MIT License"
    - path: "packages/widget/package.json"
      provides: "Complete package metadata"
      contains: "publishConfig"
  key_links:
    - from: "packages/widget/README.md"
      to: "packages/widget/src/types.ts"
      via: "Props documentation matches actual TypeScript interface"
      pattern: "apiUrl.*apiKey.*productId"
    - from: "packages/widget/package.json"
      to: "packages/widget/dist/"
      via: "files field and exports field point to built artifacts"
      pattern: "\"files\".*dist"
---

<objective>
Prepare the @pricing-matrix/widget package for npm publishing by adding missing metadata, documentation, and license file.

Purpose: The widget builds correctly but lacks README.md, LICENSE, and package.json metadata (repository, homepage, bugs, author, publishConfig) needed for a professional npm package listing.
Output: A publish-ready package that passes `npm pack --dry-run` and `npm publish --dry-run` verification.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-publish-widget-to-npm/07-RESEARCH.md

@packages/widget/package.json
@packages/widget/src/index.ts
@packages/widget/src/types.ts
@packages/widget/src/PriceMatrixWidget.tsx
@packages/widget/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add package metadata, README, and LICENSE</name>
  <files>packages/widget/package.json, packages/widget/README.md, packages/widget/LICENSE</files>
  <action>
    1. Update `packages/widget/package.json` — add these fields (merge with existing, do NOT overwrite existing fields):
       ```json
       {
         "author": "gjrkdk",
         "repository": {
           "type": "git",
           "url": "https://github.com/gjrkdk/pricing-app.git",
           "directory": "packages/widget"
         },
         "homepage": "https://github.com/gjrkdk/pricing-app/tree/main/packages/widget#readme",
         "bugs": {
           "url": "https://github.com/gjrkdk/pricing-app/issues"
         },
         "publishConfig": {
           "access": "public"
         }
       }
       ```
       Note: `keywords`, `license`, `description`, `version` (0.1.0) already exist and are correct — leave them.
       Add `"draft-order"` to the existing keywords array if not present.

    2. Create `packages/widget/LICENSE` with MIT license text, year 2026, copyright holder "gjrkdk".

    3. Create `packages/widget/README.md` with these sections (use the research template from 07-RESEARCH.md as a base):
       - Title: `# @pricing-matrix/widget`
       - One-line description matching package.json description
       - **Installation** section with `npm install @pricing-matrix/widget` and peer dependency note (react ^18.0.0, react-dom ^18.0.0)
       - **Usage** section with a complete TSX example showing PriceMatrixWidget with all required props (apiUrl, apiKey, productId) and optional props (theme, onAddToCart)
       - **API** section with a Props table documenting all PriceMatrixWidgetProps fields (apiUrl, apiKey, productId, theme, onAddToCart) with types and required/optional status
       - **ThemeProps** subsection documenting all theme fields (primaryColor, textColor, borderColor, borderRadius, fontSize, errorColor) with their CSS variable names and defaults
       - **AddToCartEvent** subsection documenting the callback payload (draftOrderId, checkoutUrl, price, total, dimensions, quantity)
       - **Features** section: Shadow DOM CSS isolation, live price calculation, Draft Order creation, customizable theming, TypeScript support
       - **License** section: "MIT"

       IMPORTANT: All prop names, types, and descriptions MUST match `packages/widget/src/types.ts` exactly. Cross-reference the source file.

    4. Update the `files` field in package.json to include README and LICENSE:
       Change `"files": ["dist"]` to `"files": ["dist", "README.md", "LICENSE"]`
       (npm auto-includes package.json, README, and LICENSE by convention, but being explicit is safer)
  </action>
  <verify>
    Run from `packages/widget/`:
    - `cat package.json | grep -E "repository|homepage|bugs|publishConfig|author"` — all fields present
    - `test -f README.md && echo "README exists"` — file exists
    - `test -f LICENSE && echo "LICENSE exists"` — file exists
    - `head -1 README.md` — shows "# @pricing-matrix/widget"
  </verify>
  <done>
    package.json has repository, homepage, bugs, author, and publishConfig fields. README.md exists with installation, usage example, and full API reference. LICENSE file exists with MIT text.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and verify package contents</name>
  <files>packages/widget/dist/price-matrix-widget.es.js, packages/widget/dist/price-matrix-widget.umd.js, packages/widget/dist/index.d.ts</files>
  <action>
    Run from `packages/widget/` directory:

    1. Clean build: `rm -rf dist && npm run build`
       Expected output: ES module, UMD bundle, and rolled-up TypeScript definitions in dist/

    2. Verify build artifacts exist:
       - `dist/price-matrix-widget.es.js` (ES module)
       - `dist/price-matrix-widget.umd.js` (UMD bundle)
       - `dist/index.d.ts` (TypeScript definitions)

    3. Run `npm pack --dry-run` and verify output shows:
       - package.json
       - README.md
       - LICENSE
       - dist/price-matrix-widget.es.js
       - dist/price-matrix-widget.umd.js
       - dist/index.d.ts
       - Total tarball size under 250 kB (was 192.9 kB without README/LICENSE, should be ~195 kB now)

    4. Run `npm publish --dry-run` to verify all metadata checks pass (this does NOT actually publish).

    If build fails, check that devDependencies are installed (`npm install` in packages/widget/).
    If npm publish --dry-run fails with auth error, that is EXPECTED and OK — auth is handled in Plan 02.
  </action>
  <verify>
    - `ls packages/widget/dist/` shows 3 files (es.js, umd.js, index.d.ts)
    - `cd packages/widget && npm pack --dry-run 2>&1` shows README.md and LICENSE in file list
    - Tarball size is reasonable (under 250 kB)
  </verify>
  <done>
    Build produces all three artifacts (ES, UMD, .d.ts). `npm pack --dry-run` confirms README.md, LICENSE, and dist/* are all included. Package is ready for publish.
  </done>
</task>

</tasks>

<verification>
1. `packages/widget/package.json` has all required metadata fields
2. `packages/widget/README.md` documents installation, usage, and full API
3. `packages/widget/LICENSE` contains MIT license
4. `npm pack --dry-run` (from packages/widget/) shows all expected files
5. Build artifacts are fresh and complete
</verification>

<success_criteria>
- Package metadata complete (repository, homepage, bugs, author, publishConfig)
- README.md with installation, usage example, props table, theme docs, event docs
- MIT LICENSE file
- Clean build producing ES + UMD + .d.ts
- `npm pack --dry-run` shows all files, tarball under 250 kB
</success_criteria>

<output>
After completion, create `.planning/phases/07-publish-widget-to-npm/07-01-SUMMARY.md`
</output>
