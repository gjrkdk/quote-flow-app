---
phase: 10-e2e-production-verification
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Published npm package installs in a fresh project outside the monorepo"
    - "Package contains TypeScript types, ESM build, UMD build, README, and LICENSE"
    - "Widget component renders when imported from the installed package"
  artifacts: []
  key_links:
    - from: "fresh test project"
      to: "npm registry"
      via: "npm install @gjrkdk/pricing-matrix-widget@0.1.0"
      pattern: "npm install.*@gjrkdk"
    - from: "widget component"
      to: "production API"
      via: "apiUrl prop pointing to quote-flow-one.vercel.app"
      pattern: "apiUrl.*quote-flow-one"
---

<objective>
Verify the published npm widget package works when installed in a fresh external project, confirming it renders correctly and can communicate with the production API.

Purpose: Confirm VERIFY-02 — the widget published to npm in Phase 07 integrates correctly in an external React project, not just within the monorepo.
Output: UAT results documenting package contents verification and widget rendering test.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-publish-widget-to-npm/07-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fresh test project and install published widget</name>
  <files>No project files modified — test project created in /tmp/widget-integration-test</files>
  <action>
    Create a fresh test project completely outside the pricing-app monorepo to validate the published npm package:

    1. Create directory: `/tmp/widget-integration-test`
    2. Run `npm init -y` in that directory
    3. Run `npm install @gjrkdk/pricing-matrix-widget@0.1.0 react@18 react-dom@18`
    4. Verify the installation succeeded (check exit code)
    5. List the package contents:
       - `ls node_modules/@gjrkdk/pricing-matrix-widget/` — expect: dist/, package.json, README.md, LICENSE
       - `ls node_modules/@gjrkdk/pricing-matrix-widget/dist/` — expect: index.d.ts, price-matrix-widget.es.js, price-matrix-widget.umd.js
    6. Verify package.json has correct exports:
       - `cat node_modules/@gjrkdk/pricing-matrix-widget/package.json` — check "main", "module", "types" fields exist
    7. Verify TypeScript types are present:
       - `cat node_modules/@gjrkdk/pricing-matrix-widget/dist/index.d.ts` — should export PriceMatrixWidget and PriceMatrixWidgetProps

    **NOTE:** If the user has a global .npmrc that redirects @gjrkdk scope to GitHub Package Registry, create a local .npmrc in the test project: `echo "@gjrkdk:registry=https://registry.npmjs.org/" > /tmp/widget-integration-test/.npmrc`
  </action>
  <verify>
    - `ls /tmp/widget-integration-test/node_modules/@gjrkdk/pricing-matrix-widget/dist/index.d.ts` returns the file
    - `ls /tmp/widget-integration-test/node_modules/@gjrkdk/pricing-matrix-widget/dist/price-matrix-widget.es.js` returns the file
    - `ls /tmp/widget-integration-test/node_modules/@gjrkdk/pricing-matrix-widget/README.md` returns the file
    - `ls /tmp/widget-integration-test/node_modules/@gjrkdk/pricing-matrix-widget/LICENSE` returns the file
  </verify>
  <done>Published package installs successfully in a fresh project outside the monorepo and contains all expected build artifacts (ESM, UMD, types, README, LICENSE).</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify widget renders in browser with production API</name>
  <what-built>
    Task 1 created a fresh test project with the published widget installed. This task verifies the widget actually renders in a browser and communicates with the production API.
  </what-built>
  <how-to-verify>
    **Prerequisites:**
    - Task 1 completed (package installed at /tmp/widget-integration-test)
    - You have an API key and product GID from Plan 10-01 (or from a store that already has QuoteFlow installed)

    **Step 1: Create a test HTML file**
    Claude will create a minimal test page at `/tmp/widget-integration-test/test.html` that:
    - Loads React 18 and ReactDOM from CDN (unpkg or esm.sh)
    - Imports the widget UMD build from node_modules
    - Renders PriceMatrixWidget with your apiUrl, apiKey, and productId

    **Step 2: Serve and test**
    1. Start a local server: `npx serve /tmp/widget-integration-test` (or `python3 -m http.server 8080`)
    2. Open http://localhost:3000/test.html (or :8080) in Chrome
    3. Expected: Widget renders with two dimension input fields, a price display area, and an Add to Cart button

    **Step 3: Test functionality**
    1. Enter width and height values that match the test matrix breakpoints
    2. Wait for price to load (debounced ~400ms)
    3. Expected: Price appears matching the matrix cell value
    4. Click "Add to Cart"
    5. Expected: Draft Order created, redirected to checkout URL (or onAddToCart callback fires)

    **Step 4: Check browser console**
    1. Open DevTools > Console
    2. Expected: No errors related to widget import, Shadow DOM, or CORS
    3. Network tab should show successful requests to quote-flow-one.vercel.app

    **Record for UAT:**
    - npm install output (version installed)
    - Screenshot of widget rendering in browser
    - Network request/response for price fetch
    - Any console errors
  </how-to-verify>
  <resume-signal>
    Type "approved" if widget renders, fetches price, and creates Draft Order from the external project.
    Or describe exact failure (import errors, CORS issues, rendering problems).
  </resume-signal>
</task>

</tasks>

<verification>
- `npm install @gjrkdk/pricing-matrix-widget@0.1.0` succeeds in fresh project
- Package contains dist/index.d.ts, dist/price-matrix-widget.es.js, dist/price-matrix-widget.umd.js, README.md, LICENSE
- Widget renders in browser when loaded from the installed package
- Widget successfully fetches price from production API
- Widget creates Draft Order via production API
- No CORS, import, or Shadow DOM errors in browser console
</verification>

<success_criteria>
The published npm package installs cleanly in a fresh project outside the monorepo, all build artifacts are present, the widget renders in a browser, fetches live price data from production, and successfully creates a Draft Order. External developers can use this package as documented.
</success_criteria>

<output>
After completion, create `.planning/phases/10-e2e-production-verification/10-02-SUMMARY.md`
</output>
